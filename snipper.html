<html>

<head>
    <title>Snippet Helper</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="http://codemirror.net/lib/codemirror.css">
    <script src="http://codemirror.net/lib/codemirror.js"></script>
    <script src="http://codemirror.net/addon/edit/matchbrackets.js"></script>
    <script src="http://codemirror.net/addon/edit/continuecomment.js"></script>
    <script src="http://codemirror.net/mode/javascript/javascript.js"></script>
    <script src="http://codemirror.net/mode/sql/sql.js"></script>
</head>

<style>
    .top {
        height: 4%;
        width: 98%;
        background-color: gray;
        padding: 5px;
        margin-bottom: 5px;

    }

    .navigator {
        height: 94%;
        width: 19%;
        float: left;
        margin-right: 5px;
    }

    .content {
        height: 94%;
        width: 80%
    }

    .navigatorSelect {
        width: 100%;
        height: 100%;
    }

    .CodeMirror {
        border: 1px solid #eee;
        height: auto;

    }
</style>

<body>

    <div class="top">
        <input type="text" id="snipName" placeholder="Enter snippet name here" />
        <select id="snipType">
			<option value="none">Choose Language</option>
			<option value="Javascript">Javascript</option>
			<option value="SQL">SQL</option>
		</select>
        <button id="btnSave">Save</button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <button id="btnNew">New Snip</button>
    </div>

    <div>
        <div class="navigator">
            <select id="snipList" class="navigatorSelect"></select>
        </div>
        <div class="content">
            <textarea class="editorTextArea" id="editor"></textarea>
        </div>
    </div>

    <script>
        //ui interactions
        $("#snipList").on("click", function(clicked) {
            showSnip();
        });

        $("#btnSave").on("click", function(clicked) {
            save();
            getSnips();
        });

        $("#btnNew").on("click", function(clicked) {
            clear();
        });

        $("#snipType").on("click", function(clicked) {
            var selected = $("#snipType").val();
            changeMode(selected);
        });


        //other
        function changeMode(lang) {
            $("#snipType").val(lang);
            if (lang == "SQL") {
                editableCodeMirror.setOption("mode", "text/x-sql");
            } else if (lang == "Javascript") {
                editableCodeMirror.setOption("mode", "javascript");
            }
        }

        function showSnip() {
            var snip = store.getSnip($("#snipList").val());
            editableCodeMirror.setValue(snip.content);
            $("#snipName").val(snip.name);
            activeSnip = snip;
            changeMode(snip.type);
        };

        function clear() {
            activeSnip = null;
            editableCodeMirror.setValue("");
            $("#snipName").val("");
            $("#snipType").val("none");
        }

        function getSnips() {
            $('#snipList').empty();
            var snipList = store.getsnipList();
            for (i in snipList) {
                $('#snipList').append($('<option>', {
                    value: snipList[i].id,
                    text: snipList[i].name
                }));
            }
            var select = document.getElementById('snipList');
            select.size = select.length + 5;
        }

        var activeSnip = null;

        var editableCodeMirror = null;

        document.addEventListener("DOMContentLoaded", function(event) {
            editableCodeMirror = CodeMirror.fromTextArea(document.getElementById('editor'), {
                mode: "javascript",
                theme: "default",
                lineNumbers: true
            });
            getSnips();
        });

        function save() {
            if (activeSnip != null) {
                var snip = store.getSnip(activeSnip.id);
                snip = {
                    content: editableCodeMirror.getValue(),
                    name: $("#snipName").val(),
                    id: activeSnip.id,
                    type: $("#snipType").val()
                };
                store.updateSnip(snip);
            } else {
                snip = {
                    content: editableCodeMirror.getValue(),
                    name: $("#snipName").val(),
                    id: getFourNumberGuid() + getFourNumberGuid(),
                    type: $("#snipType").val()
                };
                store.addSnip(snip);
            }
            activeSnip = snip;
        }

        store = {
            getSnip: function(key) {
                var snip = JSON.parse(localStorage.getItem(key));
                return snip;
            },
            getsnipList: function() {
                var snipList = JSON.parse(localStorage.getItem("snipList"));
                return snipList;
            },
            addSnip: function(snip) {
                localStorage.setItem(snip.id, JSON.stringify(snip));
                var snipList = JSON.parse(localStorage.getItem("snipList"));

                if (snipList == null) {
                    snipList = [];
                }
                snipList.push({
                    id: snip.id,
                    name: snip.name
                });
                localStorage.setItem("snipList", JSON.stringify(snipList));
            },
            updateSnip: function(snip) {
                localStorage.setItem(snip.id, JSON.stringify(snip));
                var snipList = JSON.parse(localStorage.getItem("snipList"));
                if (snipList == null) {
                    snipList = [];
                    snipList.push({
                        id: snip.id,
                        name: snip.name
                    });
                } else {
                    for (i in snipList) {
                        if (snipList[i].id == snip.id) {
                            snipList[i].name = snip.name;
                        }
                    }
                }
                localStorage.setItem("snipList", JSON.stringify(snipList));
            }
        }

        function getFourNumberGuid() {    
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        }
    </script>

</body>

</html>